<ion-view view-title="WFL" id="friends-page" wfl-backdrop>
    <ion-nav-buttons side="right">
        <button class="button button-icon button-clear ion-person-add"
                ng-click="addFriendModal()">
        </button>
    </ion-nav-buttons>

    <div class="bar bar-subheader friend-item user-item">

        <div class="user-image profile-picture"
            ui-sref="dashboard.profile({userId: currentUser.id})">
            <img ng-if="currentUser.picData || currentUser.picUrl"
                ng-src="{{currentUser.picData ? ('data:image/jpeg;base64,' + currentUser.picData) : currentUser.picUrl }}"
                alt="profile" />
        </div>
        <div class="box"
             ui-sref="dashboard.profile({userId: currentUser.id})">
            <h2 class="user-name">{{currentUser.name}}</h2>
            <p class="update-text">
                <span ng-if="!currentUser.recentFood">No Food Updates</span>
                <span ng-if="currentUser.recentFood">Last Update: {{currentUser.recentFood.date | amCalendar}}</span>
            </p>
        </div>
        <div class="actions">
            <div class="food-image-container"
                ng-class="{'has-food': currentUser.recentFood}"
                ng-click="showFoodGrid()">
                <div class="food-image"
                     alt="{{currentUser.recentFood.food.name}}"
                     ng-if="currentUser.recentFood"
                     ng-style="{'background-position': (currentUser.recentFood.food.x * foodSize)+'px '+(currentUser.recentFood.food.y * foodSize)+'px' }">
                </div>
            </div>
        </div>
    </div>

    <ion-content class="post-content has-footer has-header has-subheader">

        <ion-list>
            <ion-item class="friend-item"
                      ng-repeat="friend in friends | filter : searchFriend">

                <div class="user-image profile-picture"
                    ui-sref="dashboard.profile({userId: friend.id})">
                    <img ng-if="friend.picData || friend.picUrl"
                        ng-src="{{friend.picData ? ('data:image/jpeg;base64,' + friend.picData) : friend.picUrl }}"
                        alt="profile" />
                </div>
                <div class="text-container" ng-click="sendMessage(friend)">
                    <h2 class="name">{{friend.name}}</h2>
                    <p class="update-text">
                        <span ng-if="!friend.recentFood">No Food Updates</span>
                        <span ng-if="friend.recentFood">Last Update: {{friend.recentFood.date | amCalendar}}</span>
                    </p>
                </div>
                <div class="actions">
                    <div class="food-image-container"
                        ng-class="{'has-food': friend.recentFood}">
                        <div class="food-image"
                             alt="{{friend.recentFood.food.name}}"
                             ng-if="friend.recentFood"
                             ng-style="{'background-position': (friend.recentFood.food.x * foodSize)+'px '+(friend.recentFood.food.y * foodSize)+'px' }">
                        </div>
                    </div>
                </div>
            </ion-item>
        </ion-list>

    </ion-content>

    <ion-footer-bar class="bar-light item-input-inset" keyboard-attach>
        <label class="item-input-wrapper">
            <i class="icon ion-ios-search placeholder-icon"></i>
            <input type="search" placeholder="Type friend name to search" ng-model="searchFriend">
        </label>
    </ion-footer-bar>

    <div class="food-grid-container"
        ng-show="foodGridShown"
        ng-init="foodSet = (foodIcons | groupItems:4)">

        <ion-scroll class="icons-container">
            <div class="row" ng-repeat="iconRow in foodSet track by $index">
                <div class="col col-item"
                     ng-class="{'selected-icon': foodSelected === item}"
                     ng-repeat="item in iconRow track by item.name"
                     ng-click="selectFood(item)">
                    <div class="food-image"
                         alt="{{item.name}}"
                         ng-style="{'background-position': (item.x * foodSize)+'px '+(item.y * foodSize)+'px' }">
                    </div>
                </div>
            </div>
        </ion-scroll>

        <div class="buttons-container">
            <div class="button-bar">
              <a class="button button-assertive" ng-click="updateFoodSelected()">Update</a>
              <a class="button button-dark" ng-click="hideFoodGrid()">Cancel</a>
            </div>
        </div>
    </div>

</ion-view>
